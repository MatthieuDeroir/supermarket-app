stages:
  - build-mobile
  - test-auto-mobile
cache:
  key: gradle-cache
  paths:
    - .gradle/
    - mobile/android/.gradle/

variables:
  ANDROID_SDK_ROOT: "/sdk"
  GRADLE_USER_HOME: "$CI_PROJECT_DIR/.gradle"

build-mobile:
  stage: build-mobile
  image: reactnativecommunity/react-native-android:latest
  script:
    - echo "Building mobile application (React Native)..."
    - cd mobile
    - npm install
    - npm run android-release
    - echo "APK built successfully."
  artifacts:
    paths:
      - mobile/android/app/build/outputs/apk/release/app-release.apk
    expire_in: 1 week

test-auto-mobile:
  stage: test-auto-mobile
  image: reactnativecommunity/react-native-android:latest
  dependencies:
    - build-mobile
  script:
    - echo "Running automated tests for mobile..."
    - cd mobile
    - npm install
    - npm test
